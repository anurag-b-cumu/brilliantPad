"use strict";(()=>{var e={};e.id=499,e.ids=[499],e.modules={1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},6726:(e,t,o)=>{o.r(t),o.d(t,{config:()=>g,default:()=>p,routeModule:()=>f});var r={};o.r(r),o.d(r,{default:()=>d});var n=o(1802),i=o(7153),a=o(6249),s=o(1244),l=o(3043);let u=require("nodemailer"),c=o.n(u)().createTransport({host:process.env.EMAIL_SERVER,port:465,secure:!0,auth:{user:process.env.EMAIL_FROM,pass:process.env.EMAIL_PASSWORD},tls:{rejectUnauthorized:!1}});async function m(e){try{let t={from:`Brilliant Pad Store <${process.env.EMAIL_FROM}>`,to:e.customerEmail,subject:"Your Invoice from Brilliant Pad Store",html:`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h1 style="color: #2563eb;">Thank you for your purchase!</h1>
          <p>Your invoice number: <strong>${e._id}</strong></p>
          <p>Total amount: <strong>$${e.totalAmount}</strong></p>
          <p>
            <a 
              href="${process.env.NEXTAUTH_URL}/invoice/${e._id}"
              style="background-color: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block; margin-top: 10px;"
            >
              View Invoice and Complete Payment
            </a>
          </p>
        </div>
      `},o={from:`Brilliant Pad Store <${process.env.EMAIL_FROM}>`,to:process.env.EMAIL_FROM,subject:"New Invoice Generated",html:`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h1 style="color: #2563eb;">New Invoice Generated</h1>
          <p>Invoice number: <strong>${e._id}</strong></p>
          <p>Customer: <strong>${e.customerName}</strong></p>
          <p>Email: <strong>${e.customerEmail}</strong></p>
          <p>Total amount: <strong>$${e.totalAmount}</strong></p>
        </div>
      `},[r,n]=await Promise.all([c.sendMail(t),c.sendMail(o)]);return console.log("Customer email sent:",r.messageId),console.log("Store owner email sent:",n.messageId),{customerResult:r,ownerResult:n}}catch(e){throw console.error("Error sending emails:",e),e}}async function d(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{customerData:o,items:r}=e.body;await (0,s.Z)();let n=await l.Z.create({customerName:o.name,customerEmail:o.email,items:r.map(e=>({dogId:e._id,quantity:e.quantity,price:e.price})),totalAmount:r.reduce((e,t)=>e+t.price*t.quantity,0)});await m(n),t.status(201).json(n)}catch(e){console.error("Error creating invoice:",e),t.status(500).json({message:"Error creating invoice",error:e})}}c.verify(function(e,t){e?console.log("SMTP connection error:",e):console.log("SMTP server is ready to take our messages")});let p=(0,a.l)(r,"default"),g=(0,a.l)(r,"config"),f=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/invoices",pathname:"/api/invoices",bundlePath:"",filename:""},userland:r})},1244:(e,t,o)=>{o.d(t,{Z:()=>s});var r=o(1185),n=o.n(r);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable");let a=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=a);let s=async function(){return a.conn||(a.promise||(a.promise=n().connect(i)),a.conn=await a.promise),a.conn}},3043:(e,t,o)=>{o.d(t,{Z:()=>a});var r=o(1185),n=o.n(r);let i=new r.Schema({customerName:{type:String,required:!0},customerEmail:{type:String,required:!0},items:[{dogId:{type:r.Schema.Types.ObjectId,ref:"Dog",required:!0},quantity:{type:Number,required:!0},price:{type:Number,required:!0}}],brilliantPads:{quantity:{type:Number},price:{type:Number}},totalAmount:{type:Number,required:!0},status:{type:String,enum:["pending","paid","cancelled"],default:"pending"},paymentId:String,createdAt:{type:Date,default:Date.now}}),a=n().models.Invoice||n().model("Invoice",i)},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=t(t.s=6726);module.exports=o})();