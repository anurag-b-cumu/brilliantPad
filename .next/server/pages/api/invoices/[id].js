"use strict";(()=>{var e={};e.id=24,e.ids=[24],e.modules={1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9505:e=>{e.exports=import("socket.io")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},6385:(e,t,o)=>{o.a(e,async(e,n)=>{try{o.r(t),o.d(t,{config:()=>l,default:()=>d,routeModule:()=>u});var i=o(1802),r=o(7153),a=o(6249),c=o(5829),s=e([c]);c=(s.then?(await s)():s)[0];let d=(0,a.l)(c,"default"),l=(0,a.l)(c,"config"),u=new i.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/invoices/[id]",pathname:"/api/invoices/[id]",bundlePath:"",filename:""},userland:c});n()}catch(e){n(e)}})},1244:(e,t,o)=>{o.d(t,{Z:()=>c});var n=o(1185),i=o.n(n);let r=process.env.MONGODB_URI;if(!r)throw Error("Please define the MONGODB_URI environment variable");let a=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=a);let c=async function(){return a.conn||(a.promise||(a.promise=i().connect(r)),a.conn=await a.promise),a.conn}},7034:(e,t,o)=>{o.a(e,async(e,n)=>{try{o.d(t,{E:()=>s,m:()=>c});var i=o(9505),r=e([i]);i=(r.then?(await r)():r)[0];let a=null,c=e=>(a?console.log("Socket.IO already initialized"):(a=new i.Server(e,{cors:{origin:"http://localhost:3000",methods:["GET","POST"],credentials:!0},path:"/api/socketio"})).on("connection",e=>{console.log("Client connected:",e.id),e.on("joinInvoiceRoom",t=>{e.join(`invoice-${t}`),console.log(`Client joined invoice room: invoice-${t}`)}),e.on("paymentConfirmed",e=>{console.log("Payment confirmed for invoice:",e.invoiceId),a?.to(`invoice-${e.invoiceId}`).emit("paymentConfirmed",e)}),e.on("disconnect",()=>{console.log("Client disconnected:",e.id)})}),a),s=()=>{if(!a)throw Error("Socket.IO not initialized");return a};n()}catch(e){n(e)}})},3043:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(1185),i=o.n(n);let r=new n.Schema({customerName:{type:String,required:!0},customerEmail:{type:String,required:!0},items:[{dogId:{type:n.Schema.Types.ObjectId,ref:"Dog",required:!0},quantity:{type:Number,required:!0},price:{type:Number,required:!0}}],brilliantPads:{quantity:{type:Number},price:{type:Number}},totalAmount:{type:Number,required:!0},status:{type:String,enum:["pending","paid","cancelled"],default:"pending"},paymentId:String,createdAt:{type:Date,default:Date.now}}),a=i().models.Invoice||i().model("Invoice",r)},5829:(e,t,o)=>{o.a(e,async(e,n)=>{try{o.r(t),o.d(t,{default:()=>s});var i=o(1244),r=o(3043),a=o(7034),c=e([a]);async function s(e,t){if(await (0,i.Z)(),"GET"===e.method)try{let o=await r.Z.findById(e.query.id).populate("items.dogId").exec();if(!o)return t.status(404).json({message:"Invoice not found"});t.status(200).json(o)}catch(e){console.error("Error fetching invoice:",e),t.status(500).json({message:"Error fetching invoice",error:e})}else if("PATCH"===e.method)try{let{id:o}=e.query,{status:n}=e.body;console.log("Updating invoice status:",o,n);let i=await r.Z.findByIdAndUpdate(o,{status:n},{new:!0}).populate("items.dogId");if(!i)return t.status(404).json({error:"Invoice not found"});try{let e=(0,a.E)();console.log("Emitting payment confirmation from API:",o),e.to(`invoice-${o}`).emit("paymentConfirmed",{invoiceId:o})}catch(e){console.warn("Socket.IO not available:",e)}t.status(200).json(i)}catch(e){console.error("Error updating invoice:",e),t.status(500).json({error:"Failed to update invoice"})}else t.status(405).json({message:"Method not allowed"})}a=(c.then?(await c)():c)[0],n()}catch(e){n(e)}})},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var o=t(t.s=6385);module.exports=o})();